<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾æ–‡å†…å®¹å…³é”®è¯åˆ†æå·¥å…·</title>
    <!-- å¼•å…¥TailwindCSSç®€åŒ–æ ·å¼ -->
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen p-8">
    <div class="max-w-3xl mx-auto">
        <div class="bg-white p-8 rounded-2xl shadow-xl">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">ğŸ“Š å†…å®¹å…³é”®è¯åˆ†æå·¥å…·</h1>
                <p class="text-gray-600">æ”¯æŒå°çº¢ä¹¦ & å…¬ä¼—å·æ–‡ç« åˆ†æ</p>
            </div>

            <div class="space-y-4">
                <div>
                    <label for="urlInput" class="block text-sm font-medium text-gray-700 mb-2">
                        æ–‡ç« é“¾æ¥
                    </label>
                    <input 
                        type="text" 
                        id="urlInput" 
                        placeholder="ç²˜è´´å°çº¢ä¹¦æˆ–å…¬ä¼—å·æ–‡ç« é“¾æ¥ï¼ˆä¾‹å¦‚ï¼šhttps://www.xiaohongshu.com/...ï¼‰" 
                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"
                    >
                </div>

                <button 
                    onclick="analyzeUrl()" 
                    id="analyzeBtn"
                    class="w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white py-3 px-6 rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-200 font-medium shadow-md hover:shadow-lg transform hover:-translate-y-0.5"
                >
                    ğŸ” å¼€å§‹åˆ†æ
                </button>
            </div>

            <!-- åŠ è½½çŠ¶æ€ -->
            <div id="loading" class="mt-6 hidden">
                <div class="flex items-center justify-center space-x-3 text-blue-600">
                    <svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <span class="font-medium">æ­£åœ¨åˆ†æä¸­ï¼Œè¯·ç¨å€™...</span>
                </div>
            </div>

            <!-- ç»“æœå±•ç¤ºåŒº -->
            <div id="result" class="mt-8 hidden">
                <div class="border-t pt-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">ğŸ“ˆ åˆ†æç»“æœ</h3>
                    
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-lg">
                            <p class="text-sm text-purple-600 font-medium mb-1">é˜…è¯»é‡</p>
                            <p class="text-2xl font-bold text-purple-700" id="readCount">-</p>
                        </div>
                        <div class="bg-gradient-to-br from-green-50 to-green-100 p-4 rounded-lg">
                            <p class="text-sm text-green-600 font-medium mb-1">è¯„è®ºæ•°</p>
                            <p class="text-2xl font-bold text-green-700" id="commentCount">-</p>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-5 rounded-lg">
                        <p class="text-sm text-blue-600 font-medium mb-3">ğŸ·ï¸ æ ¸å¿ƒå…³é”®è¯</p>
                        <div id="keywords" class="flex flex-wrap gap-2"></div>
                    </div>

                    <div id="contentPreview" class="mt-4 bg-gray-50 p-4 rounded-lg hidden">
                        <p class="text-sm text-gray-600 font-medium mb-2">ğŸ“ å†…å®¹é¢„è§ˆ</p>
                        <p class="text-sm text-gray-700 line-clamp-3" id="contentText"></p>
                    </div>
                </div>
            </div>

            <!-- é”™è¯¯æç¤º -->
            <div id="error" class="mt-6 hidden">
                <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg">
                    <p class="font-medium">âŒ åˆ†æå¤±è´¥</p>
                    <p class="text-sm mt-1" id="errorMessage"></p>
                </div>
            </div>
        </div>

        <!-- ä½¿ç”¨è¯´æ˜ -->
        <div class="mt-6 bg-white p-6 rounded-2xl shadow-lg">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">ğŸ’¡ ä½¿ç”¨è¯´æ˜</h3>
            <ul class="space-y-2 text-sm text-gray-600">
                <li class="flex items-start">
                    <span class="mr-2">1.</span>
                    <span>å¤åˆ¶å°çº¢ä¹¦ç¬”è®°æˆ–å…¬ä¼—å·æ–‡ç« çš„å®Œæ•´é“¾æ¥</span>
                </li>
                <li class="flex items-start">
                    <span class="mr-2">2.</span>
                    <span>ç²˜è´´åˆ°è¾“å…¥æ¡†ä¸­ï¼Œç‚¹å‡»"å¼€å§‹åˆ†æ"æŒ‰é’®</span>
                </li>
                <li class="flex items-start">
                    <span class="mr-2">3.</span>
                    <span>ç­‰å¾…å‡ ç§’é’Ÿï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æå–å…³é”®è¯å’Œæ•°æ®</span>
                </li>
                <li class="flex items-start text-orange-600">
                    <span class="mr-2">âš ï¸</span>
                    <span>æ³¨æ„ï¼šéœ€è¦é…ç½®æœ‰æ•ˆçš„ç¬¬ä¸‰æ–¹APIå¯†é’¥æ‰èƒ½æ­£å¸¸ä½¿ç”¨</span>
                </li>
            </ul>
        </div>
    </div>

    <script>
        // è°ƒç”¨åç«¯æ¥å£
        async function analyzeUrl() {
            const url = document.getElementById('urlInput').value.trim();
            
            // éªŒè¯è¾“å…¥
            if (!url) {
                showError("è¯·è¾“å…¥æ–‡ç« é“¾æ¥ï¼");
                return;
            }

            // ç®€å•éªŒè¯é“¾æ¥æ ¼å¼
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                showError("è¯·è¾“å…¥æœ‰æ•ˆçš„é“¾æ¥åœ°å€ï¼ˆéœ€ä»¥ http:// æˆ– https:// å¼€å¤´ï¼‰");
                return;
            }

            // éšè—ä¹‹å‰çš„ç»“æœå’Œé”™è¯¯
            document.getElementById('result').classList.add('hidden');
            document.getElementById('error').classList.add('hidden');
            document.getElementById('contentPreview').classList.add('hidden');
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('analyzeBtn').disabled = true;
            document.getElementById('analyzeBtn').classList.add('opacity-50', 'cursor-not-allowed');
            
            try {
                const res = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url })
                });

                const data = await res.json();
                
                if (!res.ok) {
                    throw new Error(data.error || 'åˆ†æå¤±è´¥');
                }

                // æ¸²æŸ“ç»“æœ
                document.getElementById('readCount').textContent = formatNumber(data.readCount) || 'æœªçŸ¥';
                document.getElementById('commentCount').textContent = formatNumber(data.commentCount) || 'æœªçŸ¥';
                
                // æ¸²æŸ“å…³é”®è¯æ ‡ç­¾
                const keywordsContainer = document.getElementById('keywords');
                keywordsContainer.innerHTML = '';
                if (data.keywords && data.keywords.length > 0) {
                    data.keywords.forEach(keyword => {
                        const tag = document.createElement('span');
                        tag.className = 'bg-blue-500 text-white px-3 py-1 rounded-full text-sm font-medium';
                        tag.textContent = keyword;
                        keywordsContainer.appendChild(tag);
                    });
                } else {
                    keywordsContainer.textContent = 'æš‚æ— å…³é”®è¯';
                }

                // å¦‚æœæœ‰å†…å®¹é¢„è§ˆï¼Œæ˜¾ç¤ºå®ƒ
                if (data.contentPreview) {
                    document.getElementById('contentText').textContent = data.contentPreview;
                    document.getElementById('contentPreview').classList.remove('hidden');
                }

                document.getElementById('result').classList.remove('hidden');
            } catch (err) {
                showError(err.message);
            } finally {
                // éšè—åŠ è½½çŠ¶æ€
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('analyzeBtn').disabled = false;
                document.getElementById('analyzeBtn').classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('error').classList.remove('hidden');
        }

        // æ ¼å¼åŒ–æ•°å­—ï¼ˆæ·»åŠ åƒåˆ†ä½ï¼‰
        function formatNumber(num) {
            // åªæ£€æŸ¥ null å’Œ undefinedï¼Œ0 æ˜¯æœ‰æ•ˆçš„æ•°å€¼
            if (num === null || num === undefined) return '0';
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // æ”¯æŒå›è½¦é”®æäº¤
        document.getElementById('urlInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                analyzeUrl();
            }
        });
    </script>
</body>
</html>

